<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Définition du rapport -->
    <record id="report_booking_ticket" model="ir.actions.report">
        <field name="name">Billet de réservation</field>
        <field name="model">booking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">travel_booking.report_booking_ticket_template</field>
        <field name="report_file">travel_booking.report_booking_ticket_template</field>
        <field name="binding_model_id" ref="model_booking"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_euro"/>
    </record>

    <!-- Template pour le rapport -->
    <template id="report_booking_ticket_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <!-- Entête avec logo de la compagnie aérienne -->
                        <div class="row mb-4">
<!--                            <div class="col-6">-->
<!--                                <img src="/travel_booking/static/img/airplane_logo.png" style="max-height: 80px;" alt="Logo" t-if="o.airline"/>-->
<!--                            </div>-->
                            <div class="col-6 text-right">
                                <h3 t-field="o.booking_reference" class="text-primary"/>
                                <p t-if="o.state == 'confirmed'" class="badge badge-success">Confirmé</p>
                                <p t-elif="o.state == 'cancelled'" class="badge badge-danger">Annulé</p>
                                <p t-elif="o.state == 'en attente de paiement'" class="badge badge-warning">En attente de paiement</p>
                                <p t-else="" class="badge badge-info">Brouillon</p>
                            </div>
                        </div>

                        <!-- Section d'en-tête du billet -->
                        <div class="row bg-primary text-white rounded p-2 mb-4">
                            <div class="col-12 text-center">
                                <h2>BILLET DE RÉSERVATION</h2>
                                <h5><t t-esc="o.airline or ''"/> - Vol <t t-esc="o.flight_number or ''"/></h5>
                            </div>
                        </div>

                        <!-- Récapitulatif du voyage -->
                        <div class="row mb-4 p-2 bg-light rounded">
                            <div class="col-5 text-center border-right">
                                <h4 t-esc="o.departure_date.strftime('%d %b %Y') if o.departure_date else ''"/>
                                <h5 t-esc="o.departure_time or ''"/>
                            </div>
                            <div class="col-2 text-center d-flex align-items-center justify-content-center">
                                <i class="fa fa-plane fa-2x text-primary"></i>
                            </div>
                            <div class="col-5 text-center border-left">
                                <h4 t-esc="o.arrival_date.strftime('%d %b %Y') if o.arrival_date else ''"/>
                                <h5 t-esc="o.arrival_time or ''"/>
                            </div>
                        </div>

                        <!-- Informations passager principal -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="m-0">Passager principal</h4>
                                    </div>
                                    <div class="card-body row">
                                        <div class="col-md-6">
                                            <p><strong>Nom:</strong> <span t-field="o.name"/></p>
                                            <p><strong>Email:</strong> <span t-field="o.email"/></p>
                                            <p><strong>Téléphone:</strong> <span t-field="o.phone"/></p>
                                            <p><strong>Passeport:</strong> <span t-field="o.passport"/></p>
                                            <p t-if="o.birth_date"><strong>Date de naissance:</strong> <span t-field="o.birth_date"/></p>
                                            <p t-if="o.gender"><strong>Genre:</strong> <span t-if="o.gender == 'M'">Masculin</span><span t-if="o.gender == 'F'">Féminin</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Liste des billets (tickets) -->
                        <t t-if="o.ticket_ids">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-header bg-primary text-white">
                                            <h4 class="m-0">Billets (Tickets)</h4>
                                        </div>
                                        <div class="card-body p-0">
                                            <table class="table table-striped table-sm mb-0">
                                                <thead class="bg-light">
                                                    <tr>
                                                        <th>ticket_number</th>
                                                        <th>Passager</th>
                                                        <th>Type</th>
                                                        <th>Passeport</th>
                                                        <th>Siège</th>
                                                        <th>Repas</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="o.ticket_ids" t-as="ticket">
                                                        <tr><td><span t-field="ticket.ticket_number"/> </td>
                                                            <td><span t-field="ticket.passenger_name"/></td>
                                                            <td>
                                                                <t t-if="ticket.passenger_type == 'adult'">Adulte</t>
                                                                <t t-elif="ticket.passenger_type == 'child'">Enfant</t>
                                                                <t t-elif="ticket.passenger_type == 'infant'">Bébé</t>
                                                            </td>
                                                            <td><span t-field="ticket.passport_number"/></td>
                                                            <td>
                                                                <t t-if="ticket.seat_preference == 'window'">Hublot</t>
                                                                <t t-elif="ticket.seat_preference == 'aisle'">Couloir</t>
                                                                <t t-elif="ticket.seat_preference == 'middle'">Milieu</t>
                                                            </td>
                                                            <td>
                                                                <t t-if="ticket.meal_preference == 'regular'">Standard</t>
                                                                <t t-elif="ticket.meal_preference == 'vegetarian'">Végétarien</t>
                                                                <t t-elif="ticket.meal_preference == 'halal'">Halal</t>
                                                                <t t-elif="ticket.meal_preference == 'kosher'">Casher</t>
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <!-- Informations passagers additionnels -->
                        <t t-if="o.passenger_ids and not o.ticket_ids">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-header bg-primary text-white">
                                            <h4 class="m-0">Passagers additionnels</h4>
                                        </div>
                                        <div class="card-body p-0">
                                            <table class="table table-striped table-sm mb-0">
                                                <thead class="bg-light">
                                                    <tr>

                                                        <th>Nom</th>
                                                        <th>Type</th>
                                                        <th>Passeport</th>
                                                        <th>Siège</th>
                                                        <th>Repas</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="o.passenger_ids" t-as="passenger">
                                                        <tr>
                                                            <td><span t-field="passenger.name"/></td>
                                                            <td>
                                                                <t t-if="passenger.passenger_type == 'adult'">Adulte</t>
                                                                <t t-elif="passenger.passenger_type == 'child'">Enfant</t>
                                                                <t t-elif="passenger.passenger_type == 'infant'">Bébé</t>
                                                            </td>
                                                            <td><span t-field="passenger.passport"/></td>
                                                            <td>
                                                                <t t-if="passenger.seat_preference == 'window'">Hublot</t>
                                                                <t t-elif="passenger.seat_preference == 'aisle'">Couloir</t>
                                                                <t t-elif="passenger.seat_preference == 'middle'">Milieu</t>
                                                            </td>
                                                            <td>
                                                                <t t-if="passenger.meal_preference == 'regular'">Standard</t>
                                                                <t t-elif="passenger.meal_preference == 'vegetarian'">Végétarien</t>
                                                                <t t-elif="passenger.meal_preference == 'halal'">Halal</t>
                                                                <t t-elif="passenger.meal_preference == 'kosher'">Casher</t>
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <!-- Détails du vol et préférences -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card shadow-sm h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="m-0">Détails du vol</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr>
                                                <td><strong>Vol:</strong></td>
                                                <td><span t-field="o.flight_number"/></td>
                                            </tr>
                                            <tr>
                                                <td><strong>Compagnie:</strong></td>
                                                <td><span t-field="o.airline"/></td>
                                            </tr>
                                            <tr>
                                                <td><strong>Départ:</strong></td>
                                                <td>
                                                    <span t-esc="o.departure_date.strftime('%d/%m/%Y') if o.departure_date else ''"/>
                                                    à <span t-field="o.departure_time"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><strong>Arrivée:</strong></td>
                                                <td>
                                                    <span t-esc="o.arrival_date.strftime('%d/%m/%Y') if o.arrival_date else ''"/>
                                                    à <span t-field="o.arrival_time"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card shadow-sm h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="m-0">Informations de paiement</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr>
                                                <td><strong>Prix:</strong></td>
                                                <td><span t-field="o.price"/> <span t-field="o.currency"/></td>
                                            </tr>
                                            <tr>
                                                <td><strong>Nombre de passagers:</strong></td>
                                                <td><span t-field="o.passenger_count"/></td>
                                            </tr>
                                            <tr t-if="o.payment_method">
                                                <td><strong>Méthode de paiement:</strong></td>
                                                <td>
                                                    <t t-if="o.payment_method == 'stripe'">Stripe</t>
                                                    <t t-elif="o.payment_method == 'credit_card'">Carte de crédit</t>
                                                    <t t-elif="o.payment_method == 'bank_transfer'">Virement bancaire</t>
                                                </td>
                                            </tr>
                                            <tr t-if="o.payment_date">
                                                <td><strong>Date de paiement:</strong></td>
                                                <td><span t-field="o.payment_date"/></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Carte d'embarquement (section visuelle) -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card shadow border-primary">
                                    <div class="card-body p-3">
                                        <div class="row">
                                            <div class="col-7">
                                                <h5 class="text-primary">CARTE D'EMBARQUEMENT</h5>
                                                <div class="row">
                                                    <div class="col-6">
                                                        <p class="mb-1"><strong>PASSAGER / PASSENGER</strong></p>
                                                        <p class="mb-3"><span t-field="o.name"/></p>

                                                        <p class="mb-1"><strong>VOL / FLIGHT</strong></p>
                                                        <p class="mb-3"><span t-field="o.flight_number"/></p>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="mb-1"><strong>DATE</strong></p>
                                                        <p class="mb-3"><span t-esc="o.departure_date.strftime('%d %b %Y') if o.departure_date else ''"/></p>

                                                        <p class="mb-1"><strong>HEURE / TIME</strong></p>
                                                        <p class="mb-3"><span t-field="o.departure_time"/></p>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <p class="mb-1"><strong>SIÈGE / SEAT</strong></p>
                                                        <p>
                                                            <t t-if="o.seat_preference == 'window'">Hublot / Window</t>
                                                            <t t-elif="o.seat_preference == 'aisle'">Couloir / Aisle</t>
                                                            <t t-elif="o.seat_preference == 'middle'">Milieu / Middle</t>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-5 border-left">
                                                <!-- Placeholder pour QR Code - Image de base64 ou div pour générer un code-barres -->
                                                <div class="d-flex justify-content-center align-items-center h-100">
                                                    <div class="text-center">
                                                        <img t-if="o.booking_reference" t-attf-src="/report/barcode/QR/{{o.booking_reference}}" style="width:120px;height:120px;"/>
                                                        <p class="mt-2"><small>Référence: <span t-field="o.booking_reference"/></small></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conditions et informations complémentaires -->
                        <div class="row mt-5">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fa fa-info-circle"/> Merci d'avoir choisi notre service.
                                    <ul class="mt-2 mb-0">
                                        <li>Veuillez vous présenter à l'aéroport au moins 2 heures avant le décollage.</li>
                                        <li>Une pièce d'identité valide est requise pour l'embarquement.</li>
                                        <li>Bagages en soute: maximum 23 kg par passager (sauf mention contraire).</li>
                                        <li>Pour toute question ou modification, contactez notre service client.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Footer avec informations légales -->
                        <div class="row mt-4">
                            <div class="col-12 text-center">
                                <p class="text-muted small">
                                    <strong>IMPORTANT:</strong> Ce document sert de preuve de réservation. Veuillez le présenter à l'aéroport avec vos documents d'identité.
                                </p>
                                <p class="text-muted small">© <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y')"/> - Tous droits réservés</p>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>